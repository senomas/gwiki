{{define "settings"}}
<div class="app-shell relative min-h-screen overflow-hidden">
  <div class="pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(56,189,248,0.12),_transparent_60%),radial-gradient(circle_at_bottom,_rgba(14,116,144,0.12),_transparent_65%)]"></div>
  <div class="relative mx-auto flex min-h-screen max-w-4xl flex-col gap-6 px-4 py-8 md:px-6 md:py-10">

    <section class="flex-1 space-y-6">
      <div class="flex items-center justify-end text-xs uppercase tracking-[0.25em] text-slate-500">
        <div class="flex items-center gap-2">
          {{if and .AuthEnabled .IsAuthenticated}}
            <a class="js-quick-launcher-open rounded-xl border border-slate-800/80 bg-[#15181c] px-2.5 py-1 text-[10px] text-slate-300" href="#">{{.CurrentUser.Name}}</a>
          {{else if .AuthEnabled}}
            <a class="text-slate-400 transition hover:text-slate-200" href="/login">Login</a>
          {{end}}
        </div>
      </div>
      <header class="space-y-2">
        <h1 class="text-2xl font-semibold text-slate-100">Settings</h1>
        <p class="text-sm text-slate-400">User preferences for your notes.</p>
      </header>

      <details class="js-settings-accordion rounded-2xl border border-slate-800/70 bg-[#121417]/85 p-6 text-sm text-slate-300" open>
        <summary class="js-form-summary cursor-pointer list-none text-2xl font-semibold" tabindex="0">Appearance</summary>
        <form id="settings-form" class="mt-5 space-y-4" action="/settings/save" method="post">
          {{if .ReturnURL}}
            <input type="hidden" name="return_url" value="{{.ReturnURL}}">
          {{end}}
          <div class="space-y-2">
            <label class="block text-xs uppercase tracking-[0.2em] text-slate-500">List view</label>
            <select class="w-full rounded-xl border border-slate-800/80 bg-[#0f1216] px-3 py-2 text-sm text-slate-100 shadow-[inset_0_0_0_1px_rgba(15,23,42,0.5)] focus:border-slate-500 focus:outline-none focus:ring-2 focus:ring-sky-500/40" name="list_view">
              <option value="compact" {{if .CompactNoteList}}selected{{end}}>Compact</option>
              <option value="full" {{if .CompactNoteList}}{{else}}selected{{end}}>Full</option>
            </select>
            <p class="text-xs text-slate-500">Compact hides long note bodies in lists.</p>
          </div>
        </form>
      </details>
      <details class="js-settings-accordion rounded-2xl border border-slate-800/70 bg-[#121417]/60 p-6 text-sm text-slate-400">
        <summary class="js-form-summary cursor-pointer list-none text-2xl font-semibold" tabindex="0">Synchronization</summary>
        <div class="mt-6 space-y-4">
          {{if .GitRemoteCreds}}
            {{range $i, $remote := .GitRemoteCreds}}
              <div class="space-y-3 rounded-2xl border border-slate-800/70 bg-[#0f1216]/80 p-4">
                <div class="text-xs uppercase tracking-[0.2em] text-slate-500">{{$remote.Alias}}</div>
                <div class="text-xs text-slate-400">
                  {{if $remote.URL}}{{$remote.URL}}{{else}}(no remote URL configured){{end}}
                </div>
                <div class="grid gap-3 sm:grid-cols-2">
                  <div class="space-y-2">
                    <label class="block text-[10px] uppercase tracking-[0.2em] text-slate-500">User</label>
                    <input
                      class="w-full rounded-xl border border-slate-800/80 bg-[#0f1216] px-3 py-2 text-xs text-slate-100 shadow-[inset_0_0_0_1px_rgba(15,23,42,0.5)] focus:border-slate-500 focus:outline-none focus:ring-2 focus:ring-sky-500/40"
                      name="git_user_{{$i}}"
                      form="settings-form"
                      value="{{$remote.User}}"
                      spellcheck="false"
                    >
                  </div>
                  <div class="space-y-2">
                    <label class="block text-[10px] uppercase tracking-[0.2em] text-slate-500">Token</label>
                    <input
                      class="w-full rounded-xl border border-slate-800/80 bg-[#0f1216] px-3 py-2 text-xs text-slate-100 shadow-[inset_0_0_0_1px_rgba(15,23,42,0.5)] focus:border-slate-500 focus:outline-none focus:ring-2 focus:ring-sky-500/40"
                      name="git_token_{{$i}}"
                      form="settings-form"
                      type="password"
                      value="{{$remote.Token}}"
                      spellcheck="false"
                    >
                  </div>
                </div>
              </div>
            {{end}}
          {{else}}
            <p class="text-sm text-slate-500">No git remotes found.</p>
          {{end}}
        </div>
      </details>
      {{if .IsAdmin}}
        <details class="js-settings-accordion rounded-2xl border border-slate-800/70 bg-[#121417]/60 p-6 text-sm text-slate-400">
        <summary class="js-form-summary cursor-pointer list-none text-2xl font-semibold" tabindex="0">User Management</summary>
          <div class="mt-4 space-y-3">
            {{if .SettingsUsers}}
              <div class="overflow-hidden rounded-xl border border-slate-800/70 bg-[#0f1216]/80">
                <table class="min-w-full text-left text-xs">
                  <thead class="bg-[#0c0f12] text-[10px] uppercase tracking-[0.2em] text-slate-500">
                    <tr>
                      <th class="px-4 py-2 font-semibold">Username</th>
                      <th class="px-4 py-2 font-semibold">Roles</th>
                    </tr>
                  </thead>
                  <tbody class="divide-y divide-slate-800/70 text-slate-300">
                    {{range .SettingsUsers}}
                      <tr class="js-form-target outline-none focus:outline-none focus:ring-0 focus:bg-slate-800/40" tabindex="0">
                        <td class="px-4 py-2 font-medium text-slate-100">{{.Name}}</td>
                        <td class="px-4 py-2 text-slate-400">
                          {{if .Roles}}
                            {{range $i, $role := .Roles}}{{if $i}}, {{end}}{{$role}}{{end}}
                          {{else}}
                            â€”
                          {{end}}
                        </td>
                      </tr>
                    {{end}}
                  </tbody>
                </table>
              </div>
            {{else}}
              <p class="text-sm text-slate-500">No users found.</p>
            {{end}}
          </div>
        </details>
      {{end}}
      <div class="flex justify-end">
        <button class="rounded-xl border border-slate-700/70 bg-[#171a1f] px-4 py-2 text-sm font-semibold text-slate-100 transition hover:border-slate-500" type="submit" form="settings-form">Save</button>
      </div>
    </section>
  </div>
</div>
<script>
  (function () {
    var items = document.querySelectorAll(".js-settings-accordion");
    if (!items.length) {
      return;
    }
    items.forEach(function (item) {
      item.addEventListener("toggle", function () {
        if (!item.open) {
          return;
        }
        items.forEach(function (other) {
          if (other !== item) {
            other.open = false;
          }
        });
      });
    });
    // keyboard handling is centralized in base layout
  })();
</script>
{{end}}
