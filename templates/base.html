{{define "base"}}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{if .Title}}{{.Title}} - {{end}}gwiki</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700&display=swap');

    .app-shell {
      font-family: "Sora", ui-sans-serif, system-ui, -apple-system, "Segoe UI", sans-serif;
    }
    .note-body h1,
    .note-body h2,
    .note-body h3 {
      font-weight: 600;
      margin: 1rem 0 0.5rem;
    }
    .note-body h1 {
      font-size: 1.5rem;
    }
    .note-body h2 {
      font-size: 1.25rem;
    }
    .note-section {
      padding-left: 1rem;
    }
    .note-section__summary {
      font-size: 1.25rem;
      font-weight: 600;
      margin: 1rem 0 0.5rem;
      cursor: pointer;
      margin-left: -1rem;
    }
    .journal-tree__summary {
      position: relative;
      padding-left: 1.1rem;
      list-style: none;
    }
    .journal-tree__summary::-webkit-details-marker {
      display: none;
    }
    .journal-tree__summary::marker {
      content: "";
    }
    .journal-tree__summary::before {
      content: "";
      position: absolute;
      left: 0;
      top: 0.35rem;
      border-left: 0.45rem solid currentColor;
      border-top: 0.3rem solid transparent;
      border-bottom: 0.3rem solid transparent;
      transform: rotate(0deg);
      transition: transform 0.15s ease;
    }
    details[open] > .journal-tree__summary::before {
      transform: rotate(90deg);
    }
    .note-body h3 {
      font-size: 1.125rem;
    }
    .note-body p {
      margin: 0.75rem 0;
    }
    .note-body ul,
    .note-body ol {
      margin: 0.75rem 0 0.75rem 1.25rem;
      padding-left: 0;
    }
    .note-body li {
      margin: 0.35rem 0;
      padding-left: 0.3rem;
    }
    .note-body li:has(> input[type="checkbox"]) {
      list-style: none;
      position: relative;
      padding-left: 0.3rem;
    }
    .note-body input[type="checkbox"] {
      appearance: none;
      -webkit-appearance: none;
      width: 1rem;
      height: 1rem;
      border: 1px solid rgba(148, 163, 184, 0.5);
      border-radius: 0.25rem;
      background: transparent;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      position: relative;
      top: -1px;
      place-content: center;
      margin: 0;
      vertical-align: -0.05rem;
    }
    .note-body li:has(> input[type="checkbox"]) > input[type="checkbox"] {
      position: absolute;
      left: -1rem;
      top: 0.1rem;
    }
    .note-body input[type="checkbox"][data-task-id] {
      cursor: pointer;
    }
    .note-body input[type="checkbox"]::after {
      content: "";
      width: 0.45rem;
      height: 0.25rem;
      border-right: 2px solid rgba(15, 23, 42, 0.95);
      border-bottom: 2px solid rgba(15, 23, 42, 0.95);
      transform: rotate(45deg);
      opacity: 0;
      margin-top: -0.05rem;
    }
    .note-body input[type="checkbox"]:checked {
      background: #60a5fa;
      border-color: #60a5fa;
      box-shadow: 0 0 0 1px rgba(96, 165, 250, 0.35);
    }
    .note-body input[type="checkbox"]:checked::after {
      opacity: 1;
    }
    .note-body input[type="checkbox"]:disabled {
      cursor: default;
    }
    .note-body ul {
      list-style: disc;
    }
    .note-body ol {
      list-style: decimal;
    }
    .note-body a {
      color: #7dd3fc;
      text-decoration: underline;
      text-underline-offset: 3px;
    }
    .note-body code {
      background: rgba(15, 23, 42, 0.7);
      border-radius: 0.375rem;
      padding: 0.1rem 0.35rem;
    }
    .note-body .map-card {
      margin: 1rem 0;
      padding: 0.75rem;
      border-radius: 0.9rem;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.55);
      color: inherit;
      text-decoration: none;
    }
    .note-body .map-card:hover {
      border-color: rgba(125, 211, 252, 0.6);
      box-shadow: 0 20px 40px -30px rgba(125, 211, 252, 0.5);
    }
    .note-body .map-card__meta {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      margin-bottom: 0.75rem;
    }
    .note-body .map-card__title {
      font-size: 0.95rem;
      font-weight: 600;
      color: #e2e8f0;
    }
    .note-body .map-card__host {
      font-size: 0.75rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #94a3b8;
    }
    .note-body .map-card__embed {
      border-radius: 0.75rem;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.2);
      background: rgba(15, 23, 42, 0.5);
    }
    .note-body .map-card__embed iframe {
      display: block;
    }
    .note-body .map-embed-fallback {
      padding: 0.75rem 1rem;
      font-size: 0.9rem;
      color: #e2e8f0;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(148, 163, 184, 0.25);
    }
    .note-body .map-embed-fallback a {
      color: #7dd3fc;
      text-decoration: underline;
      text-underline-offset: 3px;
    }
    .note-body .youtube-card {
      display: flex;
      gap: 1rem;
      margin: 0.5rem 0;
      padding: 0.75rem;
      border-radius: 0.9rem;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.55);
      color: inherit;
      text-decoration: none;
    }
    .note-body .youtube-card:hover {
      border-color: rgba(125, 211, 252, 0.6);
      box-shadow: 0 20px 40px -30px rgba(125, 211, 252, 0.5);
    }
    .note-body .youtube-card__thumb {
      width: 160px;
      flex-shrink: 0;
      border-radius: 0.75rem;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.6);
    }
    .note-body .youtube-card__thumb img {
      display: block;
      width: 100%;
      height: auto;
    }
    .note-body .youtube-card__meta {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }
    .note-body .youtube-card__title {
      font-size: 0.95rem;
      font-weight: 600;
      color: #e2e8f0;
    }
    .note-body .youtube-card__host {
      font-size: 0.75rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #94a3b8;
    }
    .note-body .youtube-card--fallback {
      display: inline-flex;
      gap: 0.5rem;
      align-items: center;
      padding: 0.6rem 0.9rem;
      border-radius: 0.75rem;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.6);
      font-size: 0.85rem;
    }
    .note-body .youtube-card--fallback a {
      color: #7dd3fc;
      text-decoration: underline;
      text-underline-offset: 3px;
    }
    .note-body .tiktok-card {
      display: flex;
      gap: 1rem;
      margin: 0.5rem 0;
      padding: 0.75rem;
      border-radius: 0.9rem;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.55);
      color: inherit;
      text-decoration: none;
    }
    .note-body .tiktok-card:hover {
      border-color: rgba(125, 211, 252, 0.6);
      box-shadow: 0 20px 40px -30px rgba(125, 211, 252, 0.5);
    }
    .note-body .tiktok-card__thumb {
      width: 160px;
      flex-shrink: 0;
      border-radius: 0.75rem;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.6);
    }
    .note-body .tiktok-card__thumb img {
      display: block;
      width: 100%;
      height: auto;
    }
    .note-body .tiktok-card__meta {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }
    .note-body .tiktok-card__title {
      font-size: 0.95rem;
      font-weight: 600;
      color: #e2e8f0;
    }
    .note-body .tiktok-card__host {
      font-size: 0.75rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #94a3b8;
    }
    .note-body .tiktok-card--fallback {
      display: inline-flex;
      gap: 0.5rem;
      align-items: center;
      padding: 0.6rem 0.9rem;
      border-radius: 0.75rem;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.6);
      font-size: 0.85rem;
    }
    .note-body .tiktok-card--fallback a {
      color: #7dd3fc;
      text-decoration: underline;
      text-underline-offset: 3px;
    }
    .note-body .instagram-card {
      display: flex;
      gap: 1rem;
      margin: 0.5rem 0;
      padding: 0.75rem;
      border-radius: 0.9rem;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.55);
      color: inherit;
      text-decoration: none;
    }
    .note-body .instagram-card:hover {
      border-color: rgba(125, 211, 252, 0.6);
      box-shadow: 0 20px 40px -30px rgba(125, 211, 252, 0.5);
    }
    .note-body .instagram-card__thumb {
      width: 160px;
      flex-shrink: 0;
      border-radius: 0.75rem;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.6);
    }
    .note-body .instagram-card__thumb img {
      display: block;
      width: 100%;
      height: auto;
    }
    .note-body .instagram-card__meta {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }
    .note-body .instagram-card__title {
      font-size: 0.95rem;
      font-weight: 600;
      color: #e2e8f0;
    }
    .note-body .instagram-card__host {
      font-size: 0.75rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #94a3b8;
    }
    .note-body .instagram-card--fallback {
      display: inline-flex;
      gap: 0.5rem;
      align-items: center;
      padding: 0.6rem 0.9rem;
      border-radius: 0.75rem;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.6);
      font-size: 0.85rem;
    }
    .note-body .instagram-card--fallback a {
      color: #7dd3fc;
      text-decoration: underline;
      text-underline-offset: 3px;
    }
    .note-body .video-card {
      display: flex;
      gap: 1rem;
      margin: 0.5rem 0;
      padding: 0.75rem;
      border-radius: 0.9rem;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.55);
      color: inherit;
      text-decoration: none;
    }
    .note-body .video-card:hover {
      border-color: rgba(125, 211, 252, 0.6);
      box-shadow: 0 20px 40px -30px rgba(125, 211, 252, 0.5);
    }
    .note-body .video-card__thumb {
      width: 160px;
      flex-shrink: 0;
      border-radius: 0.75rem;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.6);
    }
    .note-body .video-card__thumb img {
      display: block;
      width: 100%;
      height: auto;
    }
    .note-body .video-card__meta {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }
    .note-body .video-card__title {
      font-size: 0.95rem;
      font-weight: 600;
      color: #e2e8f0;
    }
    .note-body .video-card__host {
      font-size: 0.75rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #94a3b8;
    }
    .note-body .video-card--fallback {
      display: inline-flex;
      gap: 0.5rem;
      align-items: center;
      padding: 0.6rem 0.9rem;
      border-radius: 0.75rem;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.6);
      font-size: 0.85rem;
    }
    .note-body .video-card--fallback a {
      color: #7dd3fc;
      text-decoration: underline;
      text-underline-offset: 3px;
    }
    .note-skeleton-line {
      height: 12px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(30, 41, 59, 0.35), rgba(59, 130, 246, 0.2), rgba(30, 41, 59, 0.35));
      background-size: 220% 100%;
      animation: note-skeleton-shimmer 1.4s ease-in-out infinite;
    }
    .note-skeleton-line--short {
      width: 45%;
    }
    .note-skeleton-line--long {
      width: 85%;
    }
    .note-skeleton-meta {
      height: 10px;
      margin-top: 0.2rem;
      opacity: 0.8;
    }
    @keyframes note-skeleton-shimmer {
      0% { background-position: 0% 0; }
      100% { background-position: -200% 0; }
    }
  </style>
</head>
<body class="{{if or (eq .ContentTemplate "view") (eq .ContentTemplate "home") (eq .ContentTemplate "tasks") (eq .ContentTemplate "edit") (eq .ContentTemplate "login") (eq .ContentTemplate "daily")}}min-h-screen bg-[#0b0d0f] text-slate-100{{else}}min-h-screen bg-slate-50 text-slate-900{{end}}">
{{if or (eq .ContentTemplate "view") (eq .ContentTemplate "home") (eq .ContentTemplate "tasks") (eq .ContentTemplate "edit") (eq .ContentTemplate "login") (eq .ContentTemplate "daily")}}
  {{.ContentHTML}}
{{else}}
  <div class="mx-auto max-w-5xl px-6 py-8">
    <header class="flex flex-wrap items-end justify-between gap-4">
      <div class="text-lg font-semibold">
        <a class="text-emerald-600 hover:text-emerald-700" href="/">gwiki</a>
      </div>
      <form class="w-full max-w-xs" action="/search" method="get">
        <input class="w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200" type="search" name="q" placeholder="Search" value="{{.SearchQuery}}">
      </form>
      {{if and .AuthEnabled .IsAuthenticated}}
        <div class="flex items-center gap-2 text-sm">
          <span class="rounded-md border border-slate-300 bg-white px-2.5 py-1 text-slate-700">{{.CurrentUser.Name}}</span>
          <a class="rounded-md border border-slate-300 bg-white px-3 py-1.5 font-semibold text-slate-700 hover:bg-slate-50" href="/logout">Logout</a>
        </div>
      {{else if .AuthEnabled}}
        <a class="rounded-md border border-slate-300 bg-white px-3 py-1.5 text-sm font-semibold text-slate-700 hover:bg-slate-50" href="/login">Login</a>
      {{end}}
    </header>
    <hr class="my-6 border-slate-200">
    <main class="max-w-4xl">
      {{.ContentHTML}}
    </main>
  </div>
{{end}}
  <script>
    (function () {
      var links = document.querySelectorAll(".js-history-back");
      var rows = document.querySelectorAll(".js-history-back-row");
      if (!links.length && !rows.length) {
        return;
      }
      if (window.history.length > 1) {
        links.forEach(function (link) {
          link.style.display = "";
        });
        return;
      }
      rows.forEach(function (row) {
        row.classList.remove("justify-between");
        row.classList.add("justify-end");
      });
    })();
  </script>
  <script>
    (function () {
      function collectCollapsed(noteBody) {
        var sections = noteBody.querySelectorAll("details.note-section");
        var collapsed = [];
        sections.forEach(function (section) {
          if (section.open) {
            return;
          }
          var lineNo = parseInt(section.getAttribute("data-line-no"), 10);
          if (!lineNo) {
            return;
          }
          collapsed.push({
            line_no: lineNo,
            line: section.getAttribute("data-line") || "",
          });
        });
        return collapsed;
      }

      var collapseTimer = null;
      function reportCollapsed(noteBody) {
        var notePath = noteBody.getAttribute("data-note-path");
        var noteID = noteBody.getAttribute("data-note-id");
        if (!notePath || !noteID) {
          return;
        }
        if (collapseTimer) {
          clearTimeout(collapseTimer);
        }
        collapseTimer = setTimeout(function () {
          fetch("/notes/" + notePath + "/collapsed", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({collapsed: collectCollapsed(noteBody)}),
          });
        }, 200);
      }

      document.addEventListener("toggle", function (event) {
        var target = event.target;
        if (!target || target.tagName !== "DETAILS" || !target.classList.contains("note-section")) {
          return;
        }
        var noteBody = target.closest(".note-body");
        if (!noteBody) {
          return;
        }
        reportCollapsed(noteBody);
      }, true);
    })();
  </script>
</body>
</html>
{{end}}
