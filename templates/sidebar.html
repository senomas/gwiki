{{define "sidebar"}}
<details
  class="w-full rounded-3xl border border-slate-800/70 bg-[#121417]/80 p-4 shadow-[0_30px_90px_-60px_rgba(0,0,0,0.95)] backdrop-blur md:hidden"
>
  <summary
    class="cursor-pointer list-none text-sm font-semibold text-slate-200"
  >
    Filters
  </summary>
  <div class="mt-4 space-y-6">{{template "sidebar_content" .}}</div>
</details>
<aside
  class="hidden w-72 shrink-0 space-y-6 rounded-3xl border border-slate-800/70 bg-[#121417]/80 p-5 shadow-[0_30px_90px_-60px_rgba(0,0,0,0.95)] backdrop-blur md:block"
>
  {{template "sidebar_content" .}}
</aside>
{{end}}

{{define "sidebar_content"}}
<div>
  <div
    class="flex items-center justify-between text-xs uppercase tracking-[0.3em] text-slate-500"
  >
    <span>{{.CalendarMonth.Label}}</span>
    <span class="flex items-center gap-2 text-slate-600">
      <span class="rounded-full border border-slate-700 px-2 py-0.5">&lt;</span>
      <span class="rounded-full border border-slate-700 px-2 py-0.5">&gt;</span>
    </span>
  </div>
  <div
    class="mt-3 grid grid-cols-7 gap-1 text-[10px] uppercase tracking-[0.2em] text-slate-600"
  >
    <span class="text-center">Sun</span>
    <span class="text-center">Mon</span>
    <span class="text-center">Tue</span>
    <span class="text-center">Wed</span>
    <span class="text-center">Thu</span>
    <span class="text-center">Fri</span>
    <span class="text-center">Sat</span>
  </div>
  <div class="mt-2 grid grid-cols-7 gap-1 text-xs">
    {{range .CalendarMonth.Weeks}}
      {{range .Days}}
        {{if .HasUpdates}}
          <a
            class="flex h-7 w-7 items-center justify-center rounded-md transition {{if .Active}}ring-1 ring-sky-400/70 bg-[#2a2f35] text-slate-100{{else}}bg-[#2a2f35] text-slate-100 hover:bg-[#3a4149]{{end}}"
            href="{{.URL}}"
            title="{{.UpdateCount}} updates"
          >
            {{.Day}}
          </a>
        {{else}}
          <div class="flex h-7 w-7 items-center justify-center rounded-md transition {{if .InMonth}}text-slate-300 hover:bg-[#1c2026]{{else}}text-slate-600{{end}}">
            {{.Day}}
          </div>
        {{end}}
      {{end}}
    {{end}}
  </div>
</div>

<div>
  <div
    class="flex items-center justify-between text-xs uppercase tracking-[0.25em] text-slate-500"
  >
    <a class="text-slate-500 transition hover:text-slate-300" href="/todo{{if .FilterQuery}}?{{.FilterQuery}}{{end}}">Todo ({{.DueCount}} / {{.TodoCount}})</a>
    <span class="text-slate-600">.</span>
  </div>
</div>

<div>
  <div
    class="flex items-center justify-between text-xs uppercase tracking-[0.25em] text-slate-500"
  >
    <span>Tags</span>
    <span class="text-slate-600">.</span>
  </div>
  <div class="mt-3 flex flex-wrap gap-2 text-xs">
    {{range .TagLinks}} {{if .Disabled}}
    <span
      class="rounded-full border border-slate-800/70 bg-[#15181c]/60 px-2.5 py-1 text-slate-600"
      >#{{.Name}} ({{.Count}})</span
    >
    {{else}}
    <a
      class="rounded-full border px-2.5 py-1 transition {{if .Active}}border-sky-500 bg-sky-500/20 text-sky-200{{else}}border-slate-700/70 bg-[#15181c] text-slate-300 hover:border-slate-500{{end}}"
      href="{{.URL}}"
      >#{{.Name}} ({{.Count}})</a
    >
    {{end}} {{else}}
    <span class="text-slate-500">No tags yet.</span>
    {{end}}
  </div>
</div>

<div>
  <div
    class="flex items-center justify-between text-xs uppercase tracking-[0.25em] text-slate-500"
  >
    <span>Folders</span>
    <span class="text-slate-600">.</span>
  </div>
  <div class="journal-tree mt-3 text-xs">
    {{template "folder_tree" .FolderTree}}
  </div>
</div>

{{if .Groups}}
<div>
  <div
    class="flex items-center justify-between text-xs uppercase tracking-[0.25em] text-slate-500"
  >
    <span>Groups</span>
    <span class="text-slate-600">.</span>
  </div>
  <div class="mt-3 flex flex-wrap gap-2 text-xs">
    {{range .Groups}}
      <span class="rounded-full border border-slate-800/70 bg-[#15181c]/60 px-2.5 py-1 text-slate-300">{{.}}</span>
    {{end}}
  </div>
</div>
{{end}}

<div>
  <div
    class="flex items-center justify-between text-xs uppercase tracking-[0.25em] text-slate-500"
  >
    <span>Journal</span>
    <span class="text-slate-600">.</span>
  </div>
  <div class="mt-3 text-xs">
    {{if .JournalSidebar.Years}}
    <ul class="space-y-2 text-slate-300">
      {{range .JournalSidebar.Years}}
      <li>
        <details class="space-y-2" {{if .Expanded}}open{{end}}>
          <summary
            class="journal-tree__summary cursor-pointer list-none text-slate-300 transition hover:text-slate-100"
            hx-get="/journal/year/{{.Year}}{{if $.FilterQuery}}?{{$.FilterQuery}}{{end}}"
            hx-target="#journal-year-{{.Year}}"
            hx-swap="innerHTML"
            hx-trigger="click once"
          >
            {{.Label}}
          </summary>
          <ul id="journal-year-{{.Year}}" class="space-y-2 pl-4">
            {{range .Months}}
            <li>
              <details class="space-y-2" {{if .Expanded}}open{{end}}>
                <summary
                  class="journal-tree__summary cursor-pointer list-none text-slate-300 transition hover:text-slate-100"
                  hx-get="/journal/month/{{printf "%04d-%02d" .Year .Month}}{{if $.FilterQuery}}?{{$.FilterQuery}}{{end}}"
                  hx-target="#journal-month-{{printf "%04d-%02d" .Year .Month}}"
                  hx-swap="innerHTML"
                  hx-trigger="click once"
                >
                  {{.Label}}
                </summary>
                <ul id="journal-month-{{printf "%04d-%02d" .Year .Month}}" class="space-y-1 pl-4">
                  {{range .Days}}
                  <li>
                    <a class="text-slate-300 transition hover:text-slate-100" href="{{.URL}}{{if $.FilterQuery}}?{{$.FilterQuery}}{{end}}">{{.Label}}</a>
                  </li>
                  {{end}}
                </ul>
              </details>
            </li>
            {{end}}
          </ul>
        </details>
      </li>
      {{end}}
    </ul>
    {{else}}
      <span class="text-slate-500">No journal entries yet.</span>
    {{end}}
  </div>
</div>

<div class="text-xs uppercase tracking-[0.2em] text-slate-600">
  GWIKI v{{.BuildVersion}}
</div>
{{end}}

{{define "sidebar_skeleton"}}
<div class="w-full rounded-3xl border border-slate-800/70 bg-[#121417]/60 p-5 shadow-[0_30px_90px_-60px_rgba(0,0,0,0.95)] backdrop-blur">
  <div class="space-y-6 animate-pulse text-xs text-slate-600">
    <div class="h-4 w-24 rounded bg-slate-800/70"></div>
    <div class="space-y-2">
      <div class="h-3 w-full rounded bg-slate-800/70"></div>
      <div class="h-3 w-5/6 rounded bg-slate-800/70"></div>
      <div class="h-3 w-2/3 rounded bg-slate-800/70"></div>
    </div>
    <div class="space-y-2">
      <div class="h-3 w-20 rounded bg-slate-800/70"></div>
      <div class="flex flex-wrap gap-2">
        <div class="h-6 w-14 rounded-full bg-slate-800/70"></div>
        <div class="h-6 w-20 rounded-full bg-slate-800/70"></div>
        <div class="h-6 w-12 rounded-full bg-slate-800/70"></div>
      </div>
    </div>
    <div class="space-y-2">
      <div class="h-3 w-16 rounded bg-slate-800/70"></div>
      <div class="space-y-2">
        <div class="h-3 w-full rounded bg-slate-800/70"></div>
        <div class="h-3 w-4/5 rounded bg-slate-800/70"></div>
      </div>
    </div>
  </div>
</div>
{{end}}

{{define "journal_year"}}
{{range .JournalYear.Months}}
<li>
  <details class="space-y-2" {{if .Expanded}}open{{end}}>
    <summary
      class="journal-tree__summary cursor-pointer list-none text-slate-300 transition hover:text-slate-100"
      hx-get="/journal/month/{{printf "%04d-%02d" .Year .Month}}{{if $.FilterQuery}}?{{$.FilterQuery}}{{end}}"
      hx-target="#journal-month-{{printf "%04d-%02d" .Year .Month}}"
      hx-swap="innerHTML"
      hx-trigger="click once"
    >
      {{.Label}}
    </summary>
    <ul id="journal-month-{{printf "%04d-%02d" .Year .Month}}" class="space-y-1 pl-4"></ul>
  </details>
</li>
{{end}}
{{end}}

{{define "journal_month"}}
{{range .JournalMonth.Days}}
<li>
  <a class="text-slate-300 transition hover:text-slate-100" href="{{.URL}}{{if $.FilterQuery}}?{{$.FilterQuery}}{{end}}">{{.Label}}</a>
</li>
{{end}}
{{end}}

{{define "folder_tree"}}
{{if .}}
<ul class="list-disc space-y-1 pl-4 text-slate-300">
  {{template "folder_tree_nodes" .}}
</ul>
{{else}}
<span class="text-slate-500">No folders yet.</span>
{{end}}
{{end}}

{{define "folder_tree_nodes"}}
{{range .}}
<li>
  {{if .URL}}
    <a class="{{if .Active}}text-sky-200{{end}}" href="{{.URL}}">{{.Name}}</a>
  {{else}}
    <span>{{.Name}}</span>
  {{end}}
  {{if .Children}}
    <ul class="list-disc space-y-1 pl-4">
      {{template "folder_tree_nodes" .Children}}
    </ul>
  {{end}}
</li>
{{end}}
{{end}}
