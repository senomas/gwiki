{{define "note_detail"}}
<div class="space-y-3">
  {{if .NotePath}}
    <h1 class="text-2xl font-semibold text-slate-100">
      {{if .NoteURL}}
        <a class="text-sky-300 hover:text-sky-200 js-note-actions" href="{{.NoteURL}}" data-note-path="{{.NotePath}}" data-note-id="{{.NoteMeta.ID}}" data-note-url="{{.NoteURL}}">{{.NoteTitle}}</a>
      {{else}}
        <a class="text-sky-300 hover:text-sky-200 js-note-actions" href="{{noteHref .NotePath .CurrentUser.Name}}" data-note-path="{{.NotePath}}" data-note-id="{{.NoteMeta.ID}}" data-note-url="{{noteHref .NotePath .CurrentUser.Name}}">{{.NoteTitle}}</a>
      {{end}}
    </h1>
  {{else}}
    <h1 class="text-2xl font-semibold text-slate-100">{{.NoteTitle}}</h1>
  {{end}}
  {{if .NoteMeta.Has}}
    <details class="group">
      <summary class="list-none cursor-pointer select-none text-xs text-slate-500">
        <span class="group-open:hidden">
          <span class="mr-2">{{if .FolderLabel}}{{.FolderLabel}}{{else}}{{if .NoteMeta.Folder}}{{.NoteMeta.Folder}}{{else}}/{{end}}{{end}}</span>
          {{if .NoteMeta.Visibility}}<span class="mr-2">{{if .NoteVisibilityDisplay}}{{.NoteVisibilityDisplay}}{{else}}{{.NoteMeta.Visibility}}{{end}}</span>{{end}}
          {{if .NoteMeta.Updated.IsZero}}
            {{if .NoteMeta.UpdatedRaw}}{{.NoteMeta.UpdatedRaw}}{{else}}Metadata{{end}}
          {{else}}
            {{.NoteMeta.Updated.Format "02/01/2006 15:04:05"}}
          {{end}}
        </span>
        <span class="hidden group-open:inline">Metadata</span>
      </summary>
      <div class="mt-2 grid gap-x-6 gap-y-1 text-xs text-slate-500 sm:grid-cols-[max-content,1fr]">
        <span class="uppercase tracking-[0.18em] text-slate-600">Folder</span><span>{{if .FolderLabel}}{{.FolderLabel}}{{else}}{{if .NoteMeta.Folder}}{{.NoteMeta.Folder}}{{else}}/{{end}}{{end}}</span>
        {{if .NoteMeta.Updated.IsZero}}{{else}}<span class="uppercase tracking-[0.18em] text-slate-600">Updated</span><span>{{.NoteMeta.Updated.Format "02/01/2006 15:04:05"}}</span>{{end}}
        {{if .NoteMeta.Created.IsZero}}{{else}}<span class="uppercase tracking-[0.18em] text-slate-600">Created</span><span>{{.NoteMeta.Created.Format "02/01/2006 15:04:05"}}</span>{{end}}
        {{if .NoteMeta.UpdatedRaw}}<span class="uppercase tracking-[0.18em] text-slate-600">Updated</span><span>{{.NoteMeta.UpdatedRaw}}</span>{{end}}
        {{if .NoteMeta.CreatedRaw}}<span class="uppercase tracking-[0.18em] text-slate-600">Created</span><span>{{.NoteMeta.CreatedRaw}}</span>{{end}}
        {{if .NoteMeta.Priority}}<span class="uppercase tracking-[0.18em] text-slate-600">Priority</span><span>{{.NoteMeta.Priority}}</span>{{end}}
        {{if .NoteMeta.Visibility}}<span class="uppercase tracking-[0.18em] text-slate-600">Visibility</span><span>{{if .NoteVisibilityDisplay}}{{.NoteVisibilityDisplay}}{{else}}{{.NoteMeta.Visibility}}{{end}}</span>{{end}}
        {{if .NoteMeta.ID}}<span class="uppercase tracking-[0.18em] text-slate-600">ID</span><span>{{.NoteMeta.ID}}</span>{{end}}
        {{if gt .NoteMeta.HistoryCount 0}}
          <span class="uppercase tracking-[0.18em] text-slate-600">History</span>
          <div class="space-y-1">
            {{range .NoteMeta.History}}
              <div>
                {{if .At.IsZero}}{{else}}<span>{{.At.Format "02/01/2006 15:04:05"}}</span>{{end}}
                {{if .Action}}<span class="ml-2">Â· {{.Action}}</span>{{end}}
                {{if .User}}<span class="ml-2 text-slate-600">({{.User}})</span>{{end}}
              </div>
            {{end}}
          </div>
        {{end}}
        {{if .NotePath}}
          <span class="uppercase tracking-[0.18em] text-slate-600">Git History</span>
          <div
            hx-get="{{noteHrefWithSuffix .NotePath "history" .CurrentUser.Name}}"
            hx-trigger="revealed"
            hx-swap="innerHTML"
          >
            <span class="text-slate-600">Loading...</span>
          </div>
        {{end}}
      </div>
    </details>
  {{end}}
  <div class="note-body text-sm leading-relaxed text-slate-200" data-note-id="{{.NoteMeta.ID}}" data-note-path="{{.NotePath}}">
    {{.RenderedHTML}}
  </div>
  {{if .ShowHiding}}
  <details class="group mt-3 border-t border-slate-800/70 pt-3">
    <summary class="list-none cursor-pointer select-none text-xs uppercase tracking-[0.18em] text-slate-500">
      Hiding ({{.CompletedTaskCount}} completed task{{if ne .CompletedTaskCount 1}}s{{end}})
    </summary>
    <div class="note-body mt-3 text-sm leading-relaxed text-slate-300">
      {{range .HiddenBlocks}}{{.RenderedHTML}}{{end}}
    </div>
  </details>
  {{end}}
</div>
{{end}}

{{define "note_detail_skeleton"}}
<div class="space-y-3">
  {{if .NotePath}}
    <h1 class="text-2xl font-semibold text-slate-100">
      {{if .NoteURL}}
        <a class="text-sky-300 hover:text-sky-200 js-note-actions" href="{{.NoteURL}}" data-note-path="{{.NotePath}}" data-note-id="{{.NoteMeta.ID}}" data-note-url="{{.NoteURL}}">
          {{if .NoteFileName}}{{.NoteFileName}}{{else}}{{.NoteTitle}}{{end}}
        </a>
      {{else}}
      <a class="text-sky-300 hover:text-sky-200 js-note-actions" href="{{noteHref .NotePath .CurrentUser.Name}}" data-note-path="{{.NotePath}}" data-note-id="{{.NoteMeta.ID}}" data-note-url="{{noteHref .NotePath .CurrentUser.Name}}">
        {{if .NoteFileName}}{{.NoteFileName}}{{else}}{{.NoteTitle}}{{end}}
      </a>
      {{end}}
    </h1>
  {{else}}
    <h1 class="text-2xl font-semibold text-slate-100">{{if .NoteFileName}}{{.NoteFileName}}{{else}}{{.NoteTitle}}{{end}}</h1>
  {{end}}
  <div class="note-skeleton-meta note-skeleton-line note-skeleton-line--short"></div>
  <div class="note-body space-y-3 text-sm leading-relaxed text-slate-200">
    <div class="note-skeleton-line"></div>
    <div class="note-skeleton-line note-skeleton-line--short"></div>
    <div class="note-skeleton-line"></div>
    <div class="note-skeleton-line note-skeleton-line--long"></div>
  </div>
</div>
{{end}}
