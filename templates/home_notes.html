{{define "home_notes"}}
{{if and (eq .HomeOffset 0) .HomePriorityNotes}}
<details class="home-section" open>
  <summary class="home-section-summary pt-1 text-xs uppercase tracking-[0.22em] text-slate-500">Important ({{len .HomePriorityNotes}} notes)</summary>
{{end}}
{{if .HomePriorityNotes}}
  <div class="space-y-4 pt-2">
  {{range .HomePriorityNotes}}
    {{template "home_note_item" (dict "Note" . "Root" $)}}
  {{end}}
  </div>
{{end}}
{{if and (eq .HomeOffset 0) .HomePriorityNotes}}
</details>
{{end}}

{{if eq .HomeOffset 0}}
<details class="home-section" open>
  <summary class="home-section-summary pt-1 text-xs uppercase tracking-[0.22em] text-slate-500">Today ({{len .HomeTodayNotes}} notes)</summary>
{{end}}
{{if .HomeTodayNotes}}
  <div class="space-y-4 pt-2">
  {{range .HomeTodayNotes}}
    {{template "home_note_item" (dict "Note" . "Root" $)}}
  {{end}}
  </div>
{{end}}
{{if eq .HomeOffset 0}}
</details>
{{end}}

{{if and (eq .HomeOffset 0) .HomePlannedNotes}}
<details class="home-section" open>
  <summary class="home-section-summary pt-1 text-xs uppercase tracking-[0.22em] text-slate-500">Planned ({{len .HomePlannedNotes}} notes)</summary>
{{end}}
{{if .HomePlannedNotes}}
  <div class="space-y-4 pt-2">
  {{range .HomePlannedNotes}}
    {{template "home_note_item" (dict "Note" . "Root" $)}}
  {{end}}
  </div>
{{end}}
{{if and (eq .HomeOffset 0) .HomePlannedNotes}}
</details>
{{end}}

{{if and (eq .HomeOffset 0) .HomeWeekNotes}}
<details class="home-section" open>
  <summary class="home-section-summary pt-1 text-xs uppercase tracking-[0.22em] text-slate-500">This Week ({{len .HomeWeekNotes}} notes)</summary>
{{end}}
{{if .HomeWeekNotes}}
  <div class="space-y-4 pt-2">
  {{range .HomeWeekNotes}}
    {{template "home_note_item" (dict "Note" . "Root" $)}}
  {{end}}
  </div>
{{end}}
{{if and (eq .HomeOffset 0) .HomeWeekNotes}}
</details>
{{end}}

{{if and (eq .HomeOffset 0) .HomeMonthNotes}}
<details class="home-section" open>
  <summary class="home-section-summary pt-1 text-xs uppercase tracking-[0.22em] text-slate-500">This Month ({{len .HomeMonthNotes}} notes)</summary>
{{end}}
{{if .HomeMonthNotes}}
  <div class="space-y-4 pt-2">
  {{range .HomeMonthNotes}}
    {{template "home_note_item" (dict "Note" . "Root" $)}}
  {{end}}
  </div>
{{end}}
{{if and (eq .HomeOffset 0) .HomeMonthNotes}}
</details>
{{end}}

{{if and (eq .HomeOffset 0) .HomeYearNotes}}
<details class="home-section" open>
  <summary class="home-section-summary pt-1 text-xs uppercase tracking-[0.22em] text-slate-500">This Year ({{len .HomeYearNotes}} notes)</summary>
{{end}}
{{if .HomeYearNotes}}
  <div class="space-y-4 pt-2">
  {{range .HomeYearNotes}}
    {{template "home_note_item" (dict "Note" . "Root" $)}}
  {{end}}
  </div>
{{end}}
{{if and (eq .HomeOffset 0) .HomeYearNotes}}
</details>
{{end}}

{{if and (eq .HomeOffset 0) .HomeLastYearNotes}}
<details class="home-section" open>
  <summary class="home-section-summary pt-1 text-xs uppercase tracking-[0.22em] text-slate-500">Last Year ({{len .HomeLastYearNotes}} notes)</summary>
{{end}}
{{if .HomeLastYearNotes}}
  <div class="space-y-4 pt-2">
  {{range .HomeLastYearNotes}}
    {{template "home_note_item" (dict "Note" . "Root" $)}}
  {{end}}
  </div>
{{end}}
{{if and (eq .HomeOffset 0) .HomeLastYearNotes}}
</details>
{{end}}

{{if and (eq .HomeOffset 0) .HomeOtherNotes}}
<details class="home-section" open>
  <summary class="home-section-summary pt-1 text-xs uppercase tracking-[0.22em] text-slate-500">Others ({{len .HomeOtherNotes}} notes)</summary>
{{end}}
{{if .HomeOtherNotes}}
  <div class="space-y-4 pt-2">
  {{range .HomeOtherNotes}}
    {{template "home_note_item" (dict "Note" . "Root" $)}}
  {{end}}
  </div>
{{end}}
{{if and (eq .HomeOffset 0) .HomeOtherNotes}}
</details>
{{end}}

{{if and (eq .HomeOffset 0) (not (or .HomePriorityNotes .HomeTodayNotes .HomePlannedNotes .HomeWeekNotes .HomeMonthNotes .HomeYearNotes .HomeLastYearNotes .HomeOtherNotes))}}
<div class="py-6 text-sm text-slate-500">No notes yet.</div>
{{end}}

{{if .HomeHasMore}}
<div
  class="h-10"
  hx-get="/notes/page?offset={{.NextHomeOffset}}{{if .TagQuery}}&t={{.TagQuery}}{{end}}{{if .FolderQuery}}&f={{.FolderQuery}}{{end}}{{if .SearchQueryParam}}&s={{.SearchQueryParam}}{{end}}{{if .HomeOwner}}&o={{.HomeOwner}}{{end}}"
  hx-trigger="revealed"
  hx-swap="outerHTML"
  aria-hidden="true"
></div>
{{end}}
{{end}}

{{define "home_note_item"}}
<article
  class="rounded-2xl border border-slate-800/70 bg-[#13161a]/70 p-4 text-sm shadow-[0_20px_60px_-50px_rgba(0,0,0,0.8)]"
>
  <div class="mt-4">
    <div class="flex items-start justify-between gap-4">
      <div class="flex-1">
        {{ $note := .Note }}
        {{ $root := .Root }}
        {{ $noteURL := printf "/notes/%s" $note.Path }}
        {{ if $root.RawQuery }}{{ $noteURL = printf "/notes/%s?%s" $note.Path $root.RawQuery }}{{ end }}
        {{ $cardURL := printf "/notes/%s/card" $note.Path }}
        {{ if $root.RawQuery }}{{ $cardURL = printf "/notes/%s/card?%s" $note.Path $root.RawQuery }}{{ end }}
        <div
          hx-get="{{ $cardURL }}"
          hx-trigger="revealed"
          hx-swap="outerHTML"
        >
          {{template "note_detail_skeleton" (dict "NoteTitle" $note.Title "NoteMeta" $note.Meta "NotePath" $note.Path "NoteURL" $noteURL "NoteFileName" $note.FileName)}}
        </div>
      </div>
      {{if and $root.AuthEnabled $root.IsAuthenticated}}
      {{end}}
    </div>
  </div>
</article>
{{end}}
